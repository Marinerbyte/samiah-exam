<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychiatry Hero ðŸ©º</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(180deg, #E0E7FF 0%, #FFFFFF 100%);
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .option-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .option-card:active { transform: scale(0.95); }
        
        /* Custom Checkbox style for options */
        .option-card.selected {
            border-color: #4F46E5;
            background-color: #EEF2FF;
            box-shadow: 0 0 0 2px #4F46E5;
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <div class="max-w-md w-full">
        <!-- Progress Info -->
        <div class="flex justify-between items-center mb-4 px-2">
            <span class="text-indigo-600 font-bold tracking-wide uppercase text-xs" id="progress-text">Question 1 of 10</span>
            <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-bold" id="score-badge">Score: 0</span>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-2 mb-8">
            <div id="progress-bar" class="bg-indigo-600 h-2 rounded-full transition-all duration-500" style="width: 10%"></div>
        </div>

        <!-- Main Card -->
        <div class="glass-card rounded-[2rem] p-8 shadow-2xl relative overflow-visible">
            
            <!-- Animated Panda Mascot -->
            <div class="absolute -top-24 left-1/2 -translate-x-1/2 w-40 h-40">
                <lottie-player id="panda-anim" 
                    src="https://assets10.lottiefiles.com/packages/lf20_9n6mre.json"  
                    background="transparent" speed="1" loop autoplay>
                </lottie-player>
            </div>

            <div id="quiz-box" class="mt-10">
                <h2 id="question-text" class="text-xl font-bold text-gray-800 text-center mb-8 leading-tight">
                    Loading your psychiatry question...
                </h2>

                <div id="options-container" class="space-y-3">
                    <!-- Options will be injected here -->
                </div>

                <button id="action-btn" onclick="handleAction()" 
                    class="w-full mt-8 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl shadow-lg transition-all flex items-center justify-center gap-2">
                    Check Answer
                </button>
            </div>

            <!-- Final Result Screen (Hidden by default) -->
            <div id="result-box" class="hidden text-center py-10">
                <h1 class="text-4xl font-black text-indigo-600 mb-2">Amazing!</h1>
                <p class="text-gray-500 mb-6">You've mastered today's Psychiatry goals.</p>
                <div class="text-6xl font-bold text-gray-800 mb-8" id="final-score">0/0</div>
                <button onclick="location.reload()" class="w-full bg-gray-800 text-white font-bold py-4 rounded-2xl shadow-lg">
                    Study Again
                </button>
            </div>
        </div>
    </div>

    <script>
        const questions = {{ questions | tojson }};
        let currentIdx = 0;
        let score = 0;
        let selectedOption = null;
        let isAnswerChecked = false;

        const panda = document.querySelector('#panda-anim');

        function loadQuestion() {
            isAnswerChecked = false;
            selectedOption = null;
            const q = questions[currentIdx];
            
            document.getElementById('progress-text').innerText = `Question ${currentIdx + 1} of ${questions.length}`;
            document.getElementById('progress-bar').style.width = `${((currentIdx + 1) / questions.length) * 100}%`;
            document.getElementById('question-text').innerText = q.q;
            document.getElementById('action-btn').innerText = "Check Answer";
            document.getElementById('action-btn').className = "w-full mt-8 bg-indigo-600 text-white font-bold py-4 rounded-2xl shadow-lg opacity-50 cursor-not-allowed";

            const container = document.getElementById('options-container');
            container.innerHTML = '';

            q.options.forEach((opt, idx) => {
                const div = document.createElement('div');
                div.className = "option-card border-2 border-gray-100 rounded-2xl p-4 cursor-pointer hover:border-indigo-300 bg-white flex items-center gap-4";
                div.innerHTML = `
                    <div class="w-6 h-6 rounded-full border-2 border-gray-200 flex-shrink-0 flex items-center justify-center text-xs font-bold">
                        ${String.fromCharCode(65 + idx)}
                    </div>
                    <span class="text-gray-700 font-semibold">${opt}</span>
                `;
                div.onclick = () => selectOption(idx, div);
                container.appendChild(div);
            });

            // Set Panda to "Thinking/Happy"
            panda.load("https://assets10.lottiefiles.com/packages/lf20_9n6mre.json");
        }

        function selectOption(idx, element) {
            if(isAnswerChecked) return;
            
            selectedOption = idx;
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected', 'border-indigo-600');
            });
            element.classList.add('selected', 'border-indigo-600');
            
            const btn = document.getElementById('action-btn');
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
            btn.className = "w-full mt-8 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl shadow-lg transition-all";
        }

        function handleAction() {
            if (selectedOption === null) return;

            if (!isAnswerChecked) {
                checkAnswer();
            } else {
                currentIdx++;
                if (currentIdx < questions.length) {
                    loadQuestion();
                } else {
                    showFinalResult();
                }
            }
        }

        function checkAnswer() {
            isAnswerChecked = true;
            const correct = questions[currentIdx].answer;
            const options = document.querySelectorAll('.option-card');
            
            if (selectedOption === correct) {
                score++;
                document.getElementById('score-badge').innerText = `Score: ${score}`;
                options[selectedOption].classList.add('bg-green-100', 'border-green-600');
                // Panda Celebrate
                panda.load("https://assets1.lottiefiles.com/packages/lf20_6r9v9y.json");
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            } else {
                options[selectedOption].classList.add('bg-red-100', 'border-red-600');
                options[correct].classList.add('bg-green-100', 'border-green-600');
                // Panda Sad/Encourage
                panda.load("https://assets10.lottiefiles.com/packages/lf20_qpwb7mpx.json");
            }

            // Show explanation with SweetAlert
            setTimeout(() => {
                Swal.fire({
                    title: selectedOption === correct ? 'Excellent!' : 'Keep Learning!',
                    text: questions[currentIdx].explain,
                    icon: selectedOption === correct ? 'success' : 'info',
                    confirmButtonText: 'Got it!',
                    confirmButtonColor: '#4F46E5',
                    customClass: { popup: 'rounded-[2rem]' }
                });
            }, 500);

            document.getElementById('action-btn').innerText = "Next Question â†’";
        }

        function showFinalResult() {
            document.getElementById('quiz-box').classList.add('hidden');
            document.getElementById('result-box').classList.remove('hidden');
            document.getElementById('final-score').innerText = `${score}/${questions.length}`;
            panda.load("https://assets1.lottiefiles.com/packages/lf20_7zt8sh.json"); // Trophy/Success
            confetti({ particleCount: 300, spread: 100, origin: { y: 0.5 } });
        }

        loadQuestion();
    </script>
</body>
                    </html>
